# Риски и минимизация (RAG по Bitrix vault)

| Риск | Проявление | Минимизация |
| --- | --- | --- |
| Шум в контенте | Навигационные блоки и шаблонные вставки портят ранжирование | Вырезать `vault-nav`, фильтровать типовые шапки/подвалы при индексации |
| Дублирование | Одна сущность встречается в classic/D7/REST/курсах | Роутинг по секциям + фильтры, ограничение 1–2 секциями на запрос |
| Слабые заголовки | Нет H1/неинформативные H1 | Fallback‑title из H2/имени файла, добавлять `heading_path` |
| Морфология RU | Пропуски при лексическом поиске | Гибрид BM25 + embeddings, словарь синонимов |
| Разрывы контекста | Чанк разрезает код/таблицу | Чанкинг по AST Markdown, не разрывать блоки |
| Большой объём | Долгая индексация, рост диска | Инкрементальная индексация, кеш векторов, батч‑обработка |
| Слабый текст в UI‑гайдах | Картинки несут смысл | OCR для ключевых папок, извлечение alt/подписей |
| Неправильные ссылки | Ссылки на внешние URL/ошибочные пути | Нормализация ссылок при индексации, валидация путей |
| Дрифт источника | Контент меняется после перепарса | Версионирование индекса, журнал изменений |
| Лицензирование | Ограничения на распространение | Приватный репозиторий, ограничение доступа, заметка об источниках |
| Облачные сервисы | Утечка данных при cloud LLM | Режим offline, маскирование, DLP‑фильтр |
| Нестабильность ответов | Разный ответ на один вопрос | Низкая температура, фиксированный prompt, регресс‑набор |
| Нестабильность Colab/ngrok | Colab “засыпает”, URL меняется, endpoint падает | Кеш эмбеддингов, health-check, быстрый redeploy, fallback на BM25‑only/без rerank |
| Публичные эндпоинты | Злоупотребление, перегрузка, утечки | Опциональный `X-API-Key`, rate-limit, allowlist IP/доменов, не логировать сырой текст |
