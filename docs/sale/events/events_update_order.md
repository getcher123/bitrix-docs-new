# События, связанные с изменением заказов

**Примечание:**перечисленные ниже события устарели с версии 15.5.0, но в продукте сохранена обратная совместимость. Поэтому их можно использовать, если в настройках модуля **Интернет-магазин**отмечена опция **Включить обработку устаревших событий**. Либо вы можете использовать **события нового ядра**.



| Событие | Описание и параметры | Метод | С версии | До версии |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| OnBeforeOrderAdd | Вызывается перед добавлением заказа, может быть использовано для отмены или модификации данных. **Параметры** \| *&arFields* \| Массив полей заказа \| \| --- \| --- \| | *&arFields* | Массив полей заказа | CSaleOrder::Add | 4.0.6 | 15.5.0 |  |  |  |  |  |  |
| *&arFields* | Массив полей заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnOrderAdd | Вызывается после добавления заказа. **Параметры** \| *ID* \| Идентификатор добавленного заказа \| \| --- \| --- \| \| *arFields* \| Массив полей заказа \| | *ID* | Идентификатор добавленного заказа | *arFields* | Массив полей заказа | CSaleOrder::Add | 4.0.6 | 15.5.0 |  |  |  |  |
| *ID* | Идентификатор добавленного заказа |  |  |  |  |  |  |  |  |  |  |  |
| *arFields* | Массив полей заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnOrderSave | Вызывается после обработки свойств заказа. Отличается от OnOrderAdd тем, что сохраняются не только поля заказа, но и свойства заказа. **Параметры** \| *orderId* \| Идентификатор добавленного заказа. \| \| --- \| --- \| \| *fields* \| Массив полей заказа и дополнительные функциональные поля, влияющие на заказ. \| \| *orderFields* \| Массив свойств заказа. \| \| *isNew* \| Флаг, является ли заказ новым (true/false). \| | *orderId* | Идентификатор добавленного заказа. | *fields* | Массив полей заказа и дополнительные функциональные поля, влияющие на заказ. | *orderFields* | Массив свойств заказа. | *isNew* | Флаг, является ли заказ новым (true/false). | CSaleOrder::DoSaveOrder | 14.5.14 | 15.5.0 |
| *orderId* | Идентификатор добавленного заказа. |  |  |  |  |  |  |  |  |  |  |  |
| *fields* | Массив полей заказа и дополнительные функциональные поля, влияющие на заказ. |  |  |  |  |  |  |  |  |  |  |  |
| *orderFields* | Массив свойств заказа. |  |  |  |  |  |  |  |  |  |  |  |
| *isNew* | Флаг, является ли заказ новым (true/false). |  |  |  |  |  |  |  |  |  |  |  |
| OnBeforeOrderUpdate | Вызывается перед изменением заказа, может быть использовано для отмены или модификации данных. **Параметры** \| *ID* \| Идентификатор заказа \| \| --- \| --- \| \| *arFields* \| Массив полей заказа \| | *ID* | Идентификатор заказа | *arFields* | Массив полей заказа | CSaleOrder::Update | 4.0.6 | 15.5.0 |  |  |  |  |
| *ID* | Идентификатор заказа |  |  |  |  |  |  |  |  |  |  |  |
| *arFields* | Массив полей заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnOrderUpdate | Вызывается после изменения заказа. **Параметры** \| *ID* \| Идентификатор заказа \| \| --- \| --- \| \| *arFields* \| Массив полей заказа \| | *ID* | Идентификатор заказа | *arFields* | Массив полей заказа | CSaleOrder::Update | 4.0.6 | 15.5.0 |  |  |  |  |
| *ID* | Идентификатор заказа |  |  |  |  |  |  |  |  |  |  |  |
| *arFields* | Массив полей заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnBeforeOrderDelete | Вызывается перед удалением заказа, может быть использовано для отмены. **Параметры** \| *ID* \| Идентификатор заказа \| \| --- \| --- \| | *ID* | Идентификатор заказа | CSaleOrder::Delete | 4.0.6 | 15.5.0 |  |  |  |  |  |  |
| *ID* | Идентификатор заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnOrderDelete | вызывается после удаления заказа **Параметры** \| *ID* \| Идентификатор заказа \| \| --- \| --- \| \| *Success* \| Индикатор успешности. Выводит *true*, если удаление произошло успешно. И *false*, если удаление заказа не произошло (например, не удалось удалить корзину заказа, или подписку по заказу). \| | *ID* | Идентификатор заказа | *Success* | Индикатор успешности. Выводит *true*, если удаление произошло успешно. И *false*, если удаление заказа не произошло (например, не удалось удалить корзину заказа, или подписку по заказу). | CSaleOrder::Delete | 4.0.6 | 15.5.0 |  |  |  |  |
| *ID* | Идентификатор заказа |  |  |  |  |  |  |  |  |  |  |  |
| *Success* | Индикатор успешности. Выводит *true*, если удаление произошло успешно. И *false*, если удаление заказа не произошло (например, не удалось удалить корзину заказа, или подписку по заказу). |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrder | Вызывается после калькуляции заказа. В событии передается &arOrder, те можно вносить правки в массив заказа в обработчике события. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrderDiscount | Вызывается после расчёта скидки на заказ. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrderDelivery | Вызывается после расчёта доставки. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrderDeliveryTax | Вызывается после расчёта налога на доставку. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrderPaySystem | Вызывается после определения платёжной системы. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrderPersonType | Вызывается после определения типа плательщика. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrderProps | Вызывается после формирования свойств плательщика. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrderShoppingCart | Вызывается после формирования массива заказа из корзины. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |
| OnSaleCalculateOrderShoppingCartTax | Вызывается после определения налогов. **Параметры** \| *arOrder* \| Массив параметров заказа \| \| --- \| --- \| | *arOrder* | Массив параметров заказа | CSaleOrder::DoCalculateOrder | 11.5.0 | 15.5.0 |  |  |  |  |  |  |
| *arOrder* | Массив параметров заказа |  |  |  |  |  |  |  |  |  |  |  |






| ![](../images/f72ecd7d62.jpg) 3 **Антон Жидков**12.11.2015 12:45:21 |  |  |
| --- | --- | --- |
| Для отмены создания заказа в обработчике OnBeforeOrderAdd необходимо вернуть false. Пример: \| Код \| \| --- \| \| ``` AddEventHandler("sale", "OnBeforeOrderAdd", "OnBeforeOrderAddHandler"); function OnBeforeOrderAddHandler(&$arFields) { // ... process fields return false; } ``` \| *********** Комментарий разработчика: Да, но событие устарело с 15.5.0. | Код | ``` AddEventHandler("sale", "OnBeforeOrderAdd", "OnBeforeOrderAddHandler"); function OnBeforeOrderAddHandler(&$arFields) { // ... process fields return false; } ``` |
| Код |  |  |
| ``` AddEventHandler("sale", "OnBeforeOrderAdd", "OnBeforeOrderAddHandler"); function OnBeforeOrderAddHandler(&$arFields) { // ... process fields return false; } ``` |  |  |
|  |  |  |
