# События, связанные с изменением записей в корзине

**Примечание:**перечисленные ниже события устарели с версии 15.5.0, но в продукте сохранена обратная совместимость. Поэтому их можно использовать, если в настройках модуля **Интернет-магазин**отмечена опция **Включить обработку устаревших событий**. Либо вы можете использовать **события нового ядра**.


| Событие | Описание и параметры | Метод | С версии | До версии |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| OnBeforeBasketAdd | Вызывается перед добавлением записи в корзину, может быть использовано для отмены или модификации данных. **Параметры** \| *&arFields* \| Массив полей записи корзины \| \| --- \| --- \| Если добавление товара в корзину выполняется методом **Add2BasketByProductID**, то через него нельзя изменить название товара. Для этого добавляйте товар в корзину через **CSaleBasket::Add**. | *&arFields* | Массив полей записи корзины | CSaleBasket::Add | 8.0.3 | 15.5.0 |  |  |  |  |
| *&arFields* | Массив полей записи корзины |  |  |  |  |  |  |  |  |  |
| OnBasketAdd | Вызывается после добавления записи в корзину. **Параметры** \| *ID* \| Идентификатор добавленной записи \| \| --- \| --- \| \| *arFields* \| Массив полей записи корзины \| | *ID* | Идентификатор добавленной записи | *arFields* | Массив полей записи корзины | CSaleBasket::Add | 8.0.3 | 15.5.0 |  |  |
| *ID* | Идентификатор добавленной записи |  |  |  |  |  |  |  |  |  |
| *arFields* | Массив полей записи корзины |  |  |  |  |  |  |  |  |  |
| OnBeforeBasketUpdate | Вызывается перед изменением записи в корзине, может быть использовано для отмены или модификации данных. **Параметры** \| *ID* \| Идентификатор записи в корзине \| \| --- \| --- \| \| *&arFields* \| Массив полей записи корзины \| | *ID* | Идентификатор записи в корзине | *&arFields* | Массив полей записи корзины | CSaleBasket::Update | 8.0.3 | 15.5.0 |  |  |
| *ID* | Идентификатор записи в корзине |  |  |  |  |  |  |  |  |  |
| *&arFields* | Массив полей записи корзины |  |  |  |  |  |  |  |  |  |
| OnBasketUpdate | Вызывается после изменения записи в корзине. **Параметры** \| *ID* \| Идентификатор записи в корзине \| \| --- \| --- \| \| *arFields* \| Массив полей записи корзины \| | *ID* | Идентификатор записи в корзине | *arFields* | Массив полей записи корзины | CSaleBasket::Update | 8.0.3 | 15.5.0 |  |  |
| *ID* | Идентификатор записи в корзине |  |  |  |  |  |  |  |  |  |
| *arFields* | Массив полей записи корзины |  |  |  |  |  |  |  |  |  |
| OnBeforeBasketUpdateAfterCheck | Вызывается перед изменением корзины после проверки массива **$arFields**. **Параметры** \| *ID* \| Код записи товара в корзине \| \| --- \| --- \| \| *arFields* \| Массив новых параметров элемента корзины \| | *ID* | Код записи товара в корзине | *arFields* | Массив новых параметров элемента корзины | CSaleBasket::Update | 11.5.0 | 15.5.0 |  |  |
| *ID* | Код записи товара в корзине |  |  |  |  |  |  |  |  |  |
| *arFields* | Массив новых параметров элемента корзины |  |  |  |  |  |  |  |  |  |
| OnBeforeBasketDelete | Вызывается перед удалением записи из корзины, может быть использовано для отмены. **Параметры** \| *ID* \| Идентификатор записи в корзине \| \| --- \| --- \| | *ID* | Идентификатор записи в корзине | CSaleBasket::Delete | 8.0.3 | 15.5.0 |  |  |  |  |
| *ID* | Идентификатор записи в корзине |  |  |  |  |  |  |  |  |  |
| OnBasketDelete | Вызывается после удаления записи из корзины **Параметры** \| *ID* \| Идентификатор записи в корзине \| \| --- \| --- \| | *ID* | Идентификатор записи в корзине | CSaleBasket::Delete | 8.0.3 | 15.5.0 |  |  |  |  |
| *ID* | Идентификатор записи в корзине |  |  |  |  |  |  |  |  |  |
| OnSetCouponList | Добавляет переданные купоны. Событие является системным. **Параметры** \| *intUserID* \| Идентификатор пользователя, для которого передаются купоны. \| \| --- \| --- \| \| *arCoupons* \| Один купон или массив передаваемых купонов. \| \| *arModules* \| Массив идентификаторов модулей, которые должны принять список купонов. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. \| | *intUserID* | Идентификатор пользователя, для которого передаются купоны. | *arCoupons* | Один купон или массив передаваемых купонов. | *arModules* | Массив идентификаторов модулей, которые должны принять список купонов. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. | CSaleBasket::DoSaveOrderBasket | 11.5.0 | 15.5.0 |
| *intUserID* | Идентификатор пользователя, для которого передаются купоны. |  |  |  |  |  |  |  |  |  |
| *arCoupons* | Один купон или массив передаваемых купонов. |  |  |  |  |  |  |  |  |  |
| *arModules* | Массив идентификаторов модулей, которые должны принять список купонов. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. |  |  |  |  |  |  |  |  |  |
| OnClearCouponList | Удаляет из списка переданные купоны. Событие является системным. **Параметры** \| *intUserID* \| Идентификатор пользователя, для которого передаются купоны. \| \| --- \| --- \| \| *arCoupons* \| Один купон или массив передаваемых купонов. \| \| *arModules* \| Массив идентификаторов модулей, которые должны удалить из списка переданные купоны. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. \| | *intUserID* | Идентификатор пользователя, для которого передаются купоны. | *arCoupons* | Один купон или массив передаваемых купонов. | *arModules* | Массив идентификаторов модулей, которые должны удалить из списка переданные купоны. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. | CSaleBasket::DoSaveOrderBasket | 11.5.0 | 15.5.0 |
| *intUserID* | Идентификатор пользователя, для которого передаются купоны. |  |  |  |  |  |  |  |  |  |
| *arCoupons* | Один купон или массив передаваемых купонов. |  |  |  |  |  |  |  |  |  |
| *arModules* | Массив идентификаторов модулей, которые должны удалить из списка переданные купоны. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. |  |  |  |  |  |  |  |  |  |
| OnDeleteCouponList | Полностью удаляет список купонов. Событие является системным. **Параметры** \| *intUserID* \| Идентификатор пользователя, для которого удаляются купоны. \| \| --- \| --- \| \| *arModules* \| Массив идентификаторов модулей, из которых удаляется список купонов. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. \| | *intUserID* | Идентификатор пользователя, для которого удаляются купоны. | *arModules* | Массив идентификаторов модулей, из которых удаляется список купонов. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. | CSaleBasket::DoSaveOrderBasket | 11.5.0 | 15.5.0 |  |  |
| *intUserID* | Идентификатор пользователя, для которого удаляются купоны. |  |  |  |  |  |  |  |  |  |
| *arModules* | Массив идентификаторов модулей, из которых удаляется список купонов. Если массив пустой, то обработчик события должен обработать все модули, которые имеют обработчик этого события. |  |  |  |  |  |  |  |  |  |






| ![](../images/de0a211802.jpg) 1 **Роберт Басыров**31.05.2021 16:29:31 |  |  |
| --- | --- | --- |
| Автор: Александр Жирков OnBeforeBasketDelete не работает даже при установленной галочке Включить обработку устаревших событий, т.к. для работы с корзиной вообще другой класс используется (сейчас речь о стандартном компоненте sale.basket.basket). Аналогичное событие в d7 OnBeforeSaleBasketItemEntityDeleted, пример использования: \| Код \| \| --- \| \| ``` Main\EventManager::getInstance()->addEventHandler( 'sale', 'OnBeforeSaleBasketItemEntityDeleted', 'OnBeforeSaleBasketItemEntityDeletedHandler' ); function OnBeforeSaleBasketItemEntityDeletedHandler(Main\Event $event) { return new Main\EventResult( Main\EventResult::ERROR, new \Bitrix\Sale\ResultError('Нельзя удалить этот товар', 'ANY_ERROR_CODE'), 'sale' );} ``` \| | Код | ``` Main\EventManager::getInstance()->addEventHandler( 'sale', 'OnBeforeSaleBasketItemEntityDeleted', 'OnBeforeSaleBasketItemEntityDeletedHandler' ); function OnBeforeSaleBasketItemEntityDeletedHandler(Main\Event $event) { return new Main\EventResult( Main\EventResult::ERROR, new \Bitrix\Sale\ResultError('Нельзя удалить этот товар', 'ANY_ERROR_CODE'), 'sale' );} ``` |
| Код |  |  |
| ``` Main\EventManager::getInstance()->addEventHandler( 'sale', 'OnBeforeSaleBasketItemEntityDeleted', 'OnBeforeSaleBasketItemEntityDeletedHandler' ); function OnBeforeSaleBasketItemEntityDeletedHandler(Main\Event $event) { return new Main\EventResult( Main\EventResult::ERROR, new \Bitrix\Sale\ResultError('Нельзя удалить этот товар', 'ANY_ERROR_CODE'), 'sale' );} ``` |  |  |
|  |  |  |
