# Взаимодействие модулей

**Навигация**
- [← Оглавление курса](index.md)
- [← Предыдущий: 5187 — Административное меню](lesson_5187.md)
- [Следующий: 3475 — Установка и удаление →](lesson_3475.md)

Официальная страница урока: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=2825

Модули могут взаимодействовать между собой двумя способами: явно (прямым вызовом) и скрыто (через систему событий).



Тему урока можно изучить в новом формате — [в документации по Bitrix Framework](https://docs.1c-bitrix.ru/pages/framework/events.html). В ней улучшена структура, описание, примеры.

### Явное взаимодействие

Явное взаимодействие с помощью API. Подразумевает подключение модуля с помощью метода [CModule::IncludeModule](http://dev.1c-bitrix.ru/api_help/main/reference/cmodule/includemodule.php)(указав в качестве параметра id модуля) с последующим непосредственным вызовом метода класса или функции модуля.

Пример явного взаимодействия:

```
<?
// подключаем модуль mymodule
if (CModule::IncludeModule("mymodule"))
{
	// выполним его метод
	CMyModuleClass::DoIt();
}
?>
```

### Взаимодействие через события

> **Событие** - это какое-либо произвольное действие, в момент выполнения которого (до или после) собираются все обработчики этого события и выполняются по одному.

Сущность [событие](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=03493) позволяет сделать модули максимально независимыми друг от друга. Модуль ничего не знает об особенностях функционирования другого модуля, но может взаимодействовать с ним через интерфейс событий.

Схема работы с событиями. Модуль, инициирующий событие, в том месте кода, где это событие происходит, должен выполнить следующее:

- Собрать все зарегистрированные обработчики с помощью функции [GetModuleEvents](http://dev.1c-bitrix.ru/api_help/main/functions/module/getmoduleevents.php).
  	Выполнить их по одному с помощью функции [ExecuteModuleEvent](http://dev.1c-bitrix.ru/api_help/main/functions/module/executemoduleevent.php), обрабатывая соответствующим образом возвращаемые обработчиками значения.

В свою очередь, модуль, который хочет выполнить какие-либо действия на это событие, должен:

- Зарегистрировать в момент инсталляции свой обработчик с помощью функции [RegisterModuleDependences](http://dev.1c-bitrix.ru/api_help/main/functions/module/registermoduledependences.php).
  	Соответственно необходимо иметь эту функцию-обработчик и убедиться, что скрипт, в котором эта функция находится, подключается в файле `/bitrix/modules/ID модуля/include.php`.

#### Пример взаимодействия

Ярким примером взаимодействия такого типа является взаимодействие модулей системы с модулем **Поиска**. Этот модуль не имеет никакой информации о данных других модулей, особенностях их хранения и обработки. Он только предоставляет интерфейс для индексации данных. Любой модуль системы, который должен индексироваться, при инсталляции регистрирует обработчик на событие [OnReindex](http://dev.1c-bitrix.ru/api_help/search/events/onreindex.php). Каждый такой обработчик в свою очередь возвращает данные для индексации, которые модуль **Поиска** использует для наполнения своей базы.

Коды примеров взаимодействия через события:

```
<?
// регистрация обработчика:
// когда в модуле init_module возникнет событие OnSomeEvent
// будет вызван метод CMyModuleClass::Handler модуля handler_module

RegisterModuleDependences(
	"init_module", "OnSomeEvent",
	"handler_module", "CMyModuleClass", "Handler"
	);
?>
```

```
<?
// произвольная функция модуля init_module
// в которой генерируется событие

function MyFunction()
{
	// здесь располагается произвольный код
	// представляющий из себя событие

	// далее следует сбор зарегистрированных обработчиков
	$rsHandlers = GetModuleEvents("init_module", "OnSomeEvent");
	while($arHandler = $rsHandlers->Fetch())
		{
		// и их выполнение по одному
		if(!ExecuteModuleEvent($arHandler, $param1, $param2))
			{
			// если обработчик вернет false,
			// то например, вернем надпись "I can't do it..."
			return "I can't do it...";
			}
		}
	return "I have done it!";
}
?>
```

```
<?
// обработчик

class CMyModuleClass
{
	function Handler($param1, $param2)
	{
		if($param1=="delete all")
			return false;
		return true;
	}
}
?>
```
