# Как сделать сайт быстрым

**Навигация**
- [← Оглавление курса](index.md)
- [← Предыдущий: 3594 — Оптимизация запросов к БД](lesson_3594.md)
- [Следующий: 20390 — Если долго сохраняется элемент в административном разделе →](lesson_20390.md)

Официальная страница урока: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=5750

Разработчик в большинстве случаев под ускорением загрузки сайта понимает работу по back-end. Однако посетителю всё равно за сколько миллисекунд открывается страница у разработчика, ему важно как быстро открывается страница у него самого. А тут уже важен целый комплекс показателей. Квалифицированный разработчик должен рассматривать сайт не как кусок программного кода, за который он отвечает, а как конечный комплексный продукт.

#### Back-End

Без [отладки программного кода](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=04816), конечно же, не обойтись. Здесь разработчику в помощь приходит инструмент [Монитор производительности](/learning/course/index.php?COURSE_ID=32&CHAPTER_ID=04904&LESSON_PATH=3903.4904), который позволяет профилировать все страницы сайта на предмет кода, SQL запросов. Кроме того, этот модуль даёт рекомендации по тюнингу серверного ПО.

Далее необходимо заняться [кешированием компонентов](/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=04780).

Следующий шаг - это внедрение технологии [Композитный сайт](/learning/course/index.php?COURSE_ID=39).

Расположение сайтов на удалённых территориально серверах может серьёзно повлиять на время получения информации пользователем. Особенно это актуально для проектов, ориентирующихся на локальные рынки. Перенос хостинга в таком случае может дать существенный прирост, в ряде случаев отмечалось ускорение до 1 секунды.

#### Меры по уменьшению числа загружаемых ресурсов

- Включив [объединение css и js](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=35&LESSON_ID=4469) скриптов. В браузерах есть ограничение на количество одновременных соединений с сервером. Как правило это 6, но может доходить до 13, как в IE. То есть, если на странице 70 файлов, то браузер скачает их в несколько приёмов, а не одномоментно. Если объединить эти скрипты, то скорость загрузки увеличится.
- Используя кеширование ресурсов в браузере (Expires/Cache-Control: max-age, Last-Modified/E-tag). Нужно отдавать заголовки для картинок, css и js-скрипта. Если нет заголовков последней модификации или заголовка Expires, то на каждый хит браузер будет скачивать все ресурсы повторно.
  Если у вас есть дата последней модификации, то это уже хорошо. В этом случае на вторых и последующих хитах браузер будет делать [conditional get](http://xpoint.ru/know-how/VebAlgoritmyi/ConditionalGet?comments) запрос. То есть спрашивать: а не изменился ли этот ресурс вот с этой даты? И загружать только изменённые ресурсы. Правда и в этом случае приходится делать один дополнительный запрос.
  Чтобы избежать этого запроса достаточно настроить в Apache или NGINX выдачу заголовка Expires. Это, к сожалению, часто забывают сделать.
- Все картинки для шаблона должны быть в [спрайтах](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D1%80%D0%B0%D0%B9%D1%82_(%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%8F_%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%BA%D0%B0)#CSS-.D1.81.D0.BF.D1.80.D0.B0.D0.B9.D1.82.D1.8B). А для мелких картинок лучше вообще использовать [Base64](https://ru.wikipedia.org/wiki/Base64).

**Меры по уменьшению объёма загружаемых данных**:

- GZIP-сжатие. Рекомендуется использовать серверное сжатие. Если оно не доступно, то можно использовать модуль [Компрессия](http://dev.1c-bitrix.ru/user_help/settings/compression/index.php). Однако с этим модулем надо быть осторожным, его сжатие поддерживается не всеми хостерами.
- [Минификация](https://ru.wikipedia.org/wiki/%D0%9C%D0%B8%D0%BD%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)) CSS и Javascript. Это - вырезание пробелов, переводов строк, уменьшение локальных переменных и оптимизация кода (для js).
- Сжатие картинок специальными [утилитами](http://habrahabr.ru/post/168251/).

## Зачем нужно сжимать данные?

Скорости передачи данных сейчас велики. Зачем сжимать данные, борясь за байты? Сжать css - файл уменьшается с 10 до 8 kb, сжатие картинки даёт 3 kb.  Что даёт такой выигрыш?

Ответ в протоколе TCP/IP и понятие [Round Trip Time](https://ru.wikipedia.org/wiki/Ping) - время между отправкой запроса от клиента серверу и получением обратного ответа. Когда браузер соединяется с сервером, они договариваются между собой о размере окна, в котором они будут обмениваться данными. У каждого клиента это окно разное, более того, оно может меняться в процессе передачи данных. Одно окно передаётся за один Round Trip Time. Если окно - 8 kb, а файл 10 kb, то нужно два Round Trip Time, то есть в два раза больше времени.

**Дополнительные меры**

- Вынос ресурсов на разные домены, который позволяет обойти ограничение на 6 подключений.
- Порядок подключения ресурсов на странице: CSS вверху, Javascript – внизу. Оба они блокируют рендеринг страницы до завершения собственной загрузки. Но если css мы не можем убрать в низ страницы: без него она просто не отобразится, то Javascript - вполне убрать вниз или же грузить асинхронно.
  **Примечание**: Это же относится к Яндекс.Метрике, GoogleAnalitics  и все подобные внешние скрипты и инструменты. Несмотря на то, что они все внешние и должны попозже загружаться. Достаточно часто получается что несмотря на то, что эти скрипты грузятся асинхронно, эти файлы могут загрузится раньше рендеринга страницы и, соответственно, как только этот ресурс загрузился, он начинает выполняться. Совет: грузите все внешние инструменты (метрики, счётчики, кнопки Вконтакте и прочие) в [BX.ready](https://dev.1c-bitrix.ru/api_help/js_lib/kernel/events/bx_ready.php), то есть на факт того, что страница загрузилась.
