# Настройка виджета онлайн-чата в многосайтовой конфигурации

**Навигация**
- [← Оглавление курса](index.md)
- [← Предыдущий: 13162 — Седьмой шаг](lesson_13162.md)
- [Следующий: 8471 — Установка для разработки →](lesson_8471.md)

Официальная страница урока: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=135&LESSON_ID=22634

### Описание проблемы

Есть одна особенность при использовании

			сквозной авторизации


Сквозная авторизация включается в настройках **Главного модуля** (опция "Распространять авторизацию на все домены").

[Подробнее](https://dev.1c-bitrix.ru/user_help/settings/settings/settings.php)...

		 на сайте «1С-Битрикс: Управлением сайтом» и портале «1С-Битрикс24» в многосайтовой конфигурации на одном ядре и на поддомене основного домена:

- если клиент обращается в виджет Открытых линий *Битрикс24*, то после этого у него меняется авторизация на основном сайте – это, в свою очередь, доставит неудобства вашему клиенту.

Например, у вас сайт-магазин расположен на домене `shop.ru`, а *Битрикс24* – на поддомене этого магазина `crm.shop.ru`, и используется многосайтовая конфигурация на одном ядре ([«1С-Битрикс24: Интернет-магазин+ CRM»](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=135&CHAPTER_ID=012848)). На сайте-магазине включен виджет Открытых линий *Битрикс24* из `crm.shop.ru`.

Тогда при включенной сквозной авторизации после общения клиента в виджете *Битрикс24* у него изменится текущая авторизация на основном сайте-магазине (`shop.ru`) – пропадет доступ в кабинет клиента, потеряется корзина с заказами и на сайте будет ошибка 403, пока клиент не перейдет в корень сайта.

Чтобы этого не происходило, нужно отключить сквозную авторизацию на сайте-магазине с доменом 2-го уровня (`shop.ru`).

### Решение

1. Перейдите в административном интерфейсе сайта-магазина (`shop.ru`): Настройки &gt; Настройки продукта &gt; Сайты &gt; Список сайтов, выберите ваш сайт и удалите в поле **Доменное имя** домен основного сайта.
2. Далее нужно обязательно сбросить cookie-файлы для сайта магазина, например с помощью DevTools браузера (F12 &gt; Application &gt; Cookies: правой кнопкой мыши &gt; Clear).
3. Затем
  			в любом месте шаблона
  ![Нажмите на рисунок, чтобы увеличить](../../../images/courses/135/dev.1c-bitrix.ru/images/admin_start/admin_base/transition-to-b24/ol_widget5_sm.png)
  		 сайта-магазина (`shop.ru`): Настройки &gt; Настройки продукта &gt; Сайты &gt; Шаблоны сайта укажите данный код:
  ```
  <script>
      window.addEventListener('onBitrixLiveChat', function(event){
          var widget = event.detail.widget;
          widget.setOption('checkSameDomain', false);
      });
  </script>
  ```
  Этот код отключает дополнительную проверку мультисайтовой конфигурации для виджета онлайн-чата в модуле Открытые линии в *Битрикс24* (imopenlines 21.400.0 и выше).
  **Примечание:** Подробнее про расширенные настройки виджета онлайн-чата можно прочитать [в отдельной статье](https://helpdesk.bitrix24.ru/open/7180919/).

Всё готово. Теперь на сайте-магазина и на портале *Битрикс24* будут разные авторизации, и у клиентов  не будет проблем с потерей корзины после общения в виджете Открытых линий.



**Внимание!** Есть особенность при использовании Сайтов24 в качестве магазина. Если портал имеет адрес `portal.site.ru`, а

			лендинг

                    **Лендинг** — это одностраничный сайт, который побуждает посетителя к действию: купить, зарегистрироваться, оставить заявку, подписаться. В *Битрикс24* лендинги создаются с помощью специального модуля Сайты24.

		/магазин `site.ru`, то при открытии виджета система отобразит предупреждение о том, что используется многосайтовая конфигурация. Решение: на лендинг/магазин надо ставить код из пункта 3, описанного выше.
