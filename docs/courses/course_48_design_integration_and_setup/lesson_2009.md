# Импорт пользователей из CSV-файла

**Навигация**
- [← Оглавление курса](index.md)
- [← Предыдущий: 7198 — Страница импорта](lesson_7198.md)
- [Следующий: 2013 — Импорт пользователей из LDAP-directory →](lesson_2013.md)

Официальная страница урока: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=48&LESSON_ID=2009

### Видеоурок

### Импорт из файла

**Внимание!** При импорте не происходит перезаписи данных, если логин импортируемого пользователя совпадает с существующим. Будет создан новый пользователь. Также не будет перезаписи данных, если совпадает идентификатор.

Для добавления целого списка пользователей в систему служит специальная страница административного раздела **Импорт пользователей** (Настройки &gt; Пользователи &gt; Импорт пользователей).

![Нажмите на рисунок, чтобы увеличить](../../../images/courses/48/dev.1c-bitrix.ru/images/portal_admin/system_administration/users/users_import_11-new-sm.png)

**Важно!**

			CSV-файл создаётся

                    Создавать CSV-файлы рекомендуется в программе MS Excel. Если вы создали файл в другой программе, то рекомендуется открыть и проверить файл в MS Excel.

		 в кодировке сайта. Кодировку можно посмотреть в форме создания/редактирования сайта (*Настройки &gt; Настройки продукта &gt; Сайты &gt; Список сайтов*). Обычно это **UTF-8**.

### Подготовка файла CSV

CSV-файл должен быть подготовлен заранее. Он должен иметь следующий формат:

```
заголовок
данные
данные
данные
```

Каждая строка файла — это одна строка таблицы. Заголовок может состоять из любого количества записей, расположенных в одной строке. Он указывает тип данных, содержащихся в разделе, который следует после заголовка. Значения в строках файлов (как заголовка, так и данных) разделяются разделительным символом (**delimiter**).

## Пример заголовка данных пользователей

`LAST_NAME;PERSONAL_PHOTO;NAME;SECOND_NAME;WORK_POSITION;EMAIL;PERSONAL_BIRTHDAY;PERSONAL_GENDER;WORK_PHONE;UF_1C_PHONE_INNER;PERSONAL_MOBILE;PERSONAL_ICQ;LOGIN;IBLOCK_SECTION_NAME_1;IBLOCK_SECTION_NAME_2;IBLOCK_SECTION_NAME_3;IBLOCK_SECTION_NAME_4`

Данные в полях должны строго соответствовать порядку полей в заголовке. Вне зависимости от того, имеются ли данные для соответствующего поля, само поле должно быть указано.

Например, если заголовок файла имеет следующий вид:

```
LAST_NAME;PERSONAL_PHOTO;NAME;SECOND_NAME;WORK_POSITION;
```

а в какой-либо из строк нет данных для части полей, скажем, 2, 4 и 5, то строка с данными должна иметь вид:

```
Иванов;;Андрей;;;
```

Поля, в которых нет данных, просто отмечены разделителем.

**Важно!** Для импорта пользователей из CSV-файла минимально необходимое условие – это указание имени (**NAME**) и фамилии пользователя (**LAST_NAME**).

## Таблица заголовков полей и типов данных

В таблице приведены все типы данных и указан признак обязательно заполнения каждого поля.

| \| Значение \| Тип данных \| Обязательность \| Комментарии \|<br>\| --- \| --- \| --- \| --- \|<br>\| ACTIVE \| boolean (логический) \| Нет, по умолчанию – Да (истина) \| Активен \|<br>\| LOGIN \| string (строка) \| Нет, по умолчанию автоматически генерируется \| Логин (мин. 3 символа) \|<br>\| PASSWORD \| string (строка) \| Нет, по умолчанию автоматически генерируется \| Пароль (мин. 6 символов). Если для группы пользователей в форме редактирования группы на закладке **Безопасность** изменён параметр **Минимальная длина пароля**, то возможно, что импорт будет производиться, ошибки система выдавать не будет, но пользователи добавляться не будут. \|<br>\| NAME \| string (строка) \| Да \| Имя \|<br>\| LAST_NAME \| string (строка) \| Да \| Фамилия \|<br>\| SECOND_NAME \| string (строка) \| Нет, по умолчанию не задано \| Отчество \|<br>\| EMAIL \| string (строка) \| Нет, по умолчанию указан e-mail администратора \| E-mail. Если поле не используется необходимо отключить опцию **Проверять E-mail на уникальность при регистрации** в настройках **Главного модуля** на закладке **Авторизация**. \|<br>\| DATE_REGISTER \| date (дата) \| Нет, по умолчанию текущая дата \| Дата регистрации \|<br>\| LID \| string (строка) \| Нет \| ID сайта по умолчанию для уведомлений \|<br>\| ADMIN_NOTES \| string (строка) \| Нет \| Заметки администратора \|<br>\| EXTERNAL_AUTH_ID \| string (строка) \| Нет \| Код источника внешней авторизации \|<br>\| XML_ID \| string (строка) \| Нет \| ID пользователя для связи с внешними источниками (например, ID пользователя в какой-либо внешний базе) \|<br>\| PHONE_NUMBER \| string (строка) \| Зависит от настроек Главного модуля. \| Номер телефона для <br>регистрации<br>Начиная с версии 18.5.0, в 1С-Битрикс появились возможность регистрироваться и восстанавливать пароль по СМС. Теперь при регистрации наравне с почтовым ящиком можно использовать и номер мобильного телефона.<br>[Подробнее](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=35&LESSON_ID=12575)...<br>. Для использования поля должна быть включена опция **Регистрировать пользователей по номеру телефона** в настройках [Главного модуля](https://dev.1c-bitrix.ru/user_help/settings/settings/settings.php). Также поле будет являться обязательным если в настройках модуля отмечена опция **Номер телефона является обязательным**. Поле имеет строгий формат из 11 цифр вида: +79991234567. \|<br>\| Личные данные \| Тип данных \| Обязательность \| Комментарии \|<br>\| PERSONAL_GENDER \| string (строка) \| Нет \| Пол. M – муж.; F- жен. \|<br>\| PERSONAL_BIRTHDAY \| date (дата) \| Нет \| В формате даты \|<br>\| PERSONAL_CITY \| string (строка) \| Нет \| Город \|<br>\| PERSONAL_STATE \| string (строка) \| Нет \| Область, район \|<br>\| PERSONAL_ZIP \| string (строка) \| Нет \| Почтовый индекс \|<br>\| PERSONAL_WWW \| string (строка) \| Нет \| Персональный сайт \|<br>\| PERSONAL_PROFESSION \| string (строка) \| Нет \| Профессия \|<br>\| PERSONAL_NOTES \| string (строка) \| Нет \| Персональные заметки \|<br>\| PERSONAL_ICQ \| string (строка) \| Нет \| Номер ICQ \|<br>\| PERSONAL_PHONE \| string (строка) \| Нет \| Домашний телефон \|<br>\| PERSONAL_PHOTO \| string (строка) \| Нет \| Фото. Путь указывается относительно папки, указываемой в настройках импорта (поле **Путь к картинкам относительно корня сайта**), или относительно корня сайта, но при пустом значении поля **Путь к картинкам относительно корня сайта** \|<br>\| PERSONAL_FAX \| string (строка) \| Нет \| Факс \|<br>\| PERSONAL_MOBILE \| string (строка) \| Нет \| Мобильный номер \|<br>\| PERSONAL_PAGER \| string (строка) \| Нет \| Пейджер \|<br>\| PERSONAL_STREET \| string (строка) \| Нет \| Улица \|<br>\| PERSONAL_MAILBOX \| string (строка) \| Нет \| Почтовый ящик \|<br>\| Работа \| Тип данных \| Обязательность \| Комментарии \|<br>\| WORK_COMPANY \| string (строка) \| Нет \| Название компании \|<br>\| WORK_DEPARTMENT \| string (строка) \| Нет \| Название подразделения \|<br>\| WORK_POSITION \| string (строка) \| Нет \| Должность \|<br>\| WORK_WWW \| string (строка) \| Нет \| Рабочий сайт \|<br>\| WORK_PHONE \| string (строка) \| Нет \| Телефон \|<br>\| WORK_FAX \| string (строка) \| Нет \| Факс \|<br>\| WORK_PAGER \| string (строка) \| Нет \| Пейджер \|<br>\| WORK_STREET \| string (строка) \| Нет \| Улица \|<br>\| WORK_MAILBOX \| string (строка) \| Нет \| Почтовый ящик \|<br>\| WORK_CITY \| string (строка) \| Нет \| Город \|<br>\| WORK_STATE \| string (строка) \| Нет \| Область, район \|<br>\| WORK_ZIP \| string (строка) \| Нет \| Почтовый индекс \|<br>\| WORK_PROFILE \| string (строка) \| Нет \| Направление деятельности компании \|<br>\| WORK_LOGO \| string (строка) \| Нет \| Фото. Путь указывается относительно папки, указываемой в настройках импорта (поле **Путь к картинкам относительно корня сайта**), или относительно корня сайта, но при пустом значении поля **Путь к картинкам относительно корня сайта** \|<br>\| WORK_NOTES \| string (строка) \| Нет \| Рабочие заметки \|<br>\| UF_* \| string (строка) \| Нет \| Пользовательское свойство, созданное администратором. Свойство должно быть обязательно создано до импорта пользователей. \|<br>\| IBLOCK_SECTION_NAME_* \| string (строка) \| Нет \| Привязка к инфоблоку. Доступно 5 уровней вложенности. В коробочной Битрикс24 позволяет сразу развести сотрудников по <br>подразделениям<br>Для организации структуры должен быть создан тип инфоблока, например Оргструктура, и инфоблок Подразделения, в котором будет храниться структура компании. Создание структуры компании может быть выполнено одним из способов: автоматически или вручную.<br>Подробнее в курсе [Администратора сервиса Битрикс24 (коробочная версия)](lesson_2777.md).<br>. ***** обозначает уровень вложенности подразделения. (т.е. если подразделение верхнего уровня, то IBLOCK_SECTION_NAME_1, следующего IBLOCK_SECTION_NAME_2 и т.д.). В столбце значений указать название подразделения. На втором шаге импорта нужно указать **Привязать пользователей к разделам информационного блока: Подразделения**. \| |
| --- |

Перед форматированием CSV-файла учтите следующие **аспекты**:

- Разделитель (**delimiter**) может быть любым: запятая (,), точка с запятой (;), пробел или табуляция. Нельзя вводить пробелы между значениями. Если в качестве разделителя выбран пробел, то необходимо следить за тем, чтобы не было двойных пробелов между значениями.
- Если запятая является частью значения (например: свойства объекта перечислением через запятую), заключите значение в двойные кавычки `"рыжий,красный,зеленый"`.
- Если двойные кавычки являются частью значения, заключите значение в пару двойных кавычек. Например, "Иван" в CSV-файле должно выглядеть следующим образом: `""Иван""`.
- Пустые строки в CSV-файле не допускаются.
- Регистр не учитывается  в заголовках,  строковых значениях, логине.
- Пароли вводятся с учетом регистра.
- Логические значения могут быть представлены следующим образом: **Y** — истина; **N**  — ложь.
- Данные, расположенные в строке данных после последнего распознанного значения в строке заголовка, игнорируются. Например, если в строке заголовка файла указано 10 значений, а в строке данных упоминается 12 значений, последние 2 будут отброшены.
- Элементы данных, значения которых не указаны, обрабатываются как пустые строки.
- Формат времени должен быть установлен в формате языка сайта. Например: `MM/DD/YYYY HH:MI:SS` (для английского языка), либо `DD.MM.YYYY HH:MI:SS` (для русского языка).

## Пример CSV-файла

```
LAST_NAME,NAME,LOGIN,PASSWORD,EMAIL
Иванов,Василий,vivanov,Password1,vivanov@company.ru
Кузнецов,Владимир,vkuznetsov,Password2,vkuznetsov@company.ru
Романова,Ольга,oromanova,Password3,oromanova@company.ru
Синицына,Елена,esinitsyna,Password4,esinitsyna@company.ru
Тихомиров,Илья,itihomirov,Password5,itihomirov@company.ru
Басманов,Константин,kbasmanov,81QE1RO98M,kbasmanov@company.ru
Галкина,Екатерина,egalkina,D0O4IAYOX0,egalkina@company.ru
Королев,Михаил,mkorolev,CDUEND3SMX,mkorolev@company.ru
Матвеева,Ирина,imatveeva,GCH425XAM6,imatveeva@company.ru
Орлов,Кирилл,korlov,ZD3PZHP2E7,korlov@company.ru
```

Чтобы гарантировать отсутствие ошибок в ходе импорта, проверьте, что данные в файле соответствуют формату, указанному в начале этой главы.
Проверить правильность формата файлов можно, открыв CSV-файл в *MS Excel*, и просмотреть результат:

- Проверьте заголовки данных.
- Проверьте, что длина пароля для учетных записей, которые необходимо импортировать, составляет не менее 6 знаков.
- Проверьте, что длина логина не менее 3 символов.

После проверки CSV-файла можно приступать к импорту.

### Экспорт пользователей из системы

В качестве образца файла для импорта можно использовать файл экспорта пользователей с действующего сайта. Для этого выполните следующее:

1. Перейдите на страницу **Список пользователей** (Настройки &gt; Пользователи &gt; Список пользователей);
2. Нажмите на кнопку с шестерёнкой в правом верхнем углу страницы и выберите **Excel**, чтобы выгрузить данные из списка;
3. После выгрузки адаптируйте файл под требования CSV-формата. В частности:

  - удалите итоговые строки внизу таблицы;
  - в заголовке замените названия значений на правильные латинские названия в соответствии с **Таблицей типов данных**, приведенной в подразделе **Подготовка файла CSV**;
  - проверьте правильность заполнения полей данными в соответствии с **Таблицей типов данных**. (Например, значения пола должны быть указаны латинскими буквами **M** и **F**, а не записями **Мужской** и **Женский**).

### Выполнение процедуры импорта

В форме импорта пользователей в качестве источника данных выберите CSV-файл и нажмите кнопку **Далее**.

Заполните поля второго шага импорта (закладка **Параметры импорта**):

![Настройка параметров импорта](../../../images/courses/48/dev.1c-bitrix.ru/images/admin_start/admin_base/user_control/csv_import_11.png)

> **Совет**: по ссылке Пример справа от параметра **Файл данных** вы можете скачать хороший пример CSV файла с тестовыми данными. Особенно полезен он для администраторов коробочной версии Битрикс24, т.к. содержит пример привязки к подразделениям через IBLOCK_SECTION_NAME_*.

- **Файл данных** – укажите путь до CSV-файла.
- **Разделитель полей** – укажите разделитель, который использовался в файле.
- **Привязать пользователей к группам** – выберите группу (группы с помощью Ctrl), к которой нужно привязать пользователей из файла.
- **Путь к картинкам относительно корня сайта** – путь к папке с картинками, относительно которой будут указаны пути значений **PERSONAL_PHOTO** и **WORK_LOGO**. Если поле пустое, то в значениях **PERSONAL_PHOTO** и **WORK_LOGO** необходимо указать полный путь относительно корня сайта.
- **Привязать пользователей к разделам информационного блока** – выберите инфоблок, к которому будут привязаны пользователи, имеющие данные в значении
  			IBLOCK_SECTION_NAME_*
  **Пример:**
  В коробочном Битрикс24 можно сразу развести сотрудников по подразделениям. В импортируемом файле ***** обозначает уровень вложенности подразделения (т.е. если подразделение верхнего уровня, то IBLOCK_SECTION_NAME_1, следующего IBLOCK_SECTION_NAME_2 и т.д.). На втором шаге импорта нужно указать **Привязать пользователей к разделам информационного блока: Подразделения**.
  		. Указать можно только один инфоблок. Если один и тот же пользователь должен быть привязан к разным инфоблокам, то привязку нужно осуществить впоследствии вручную.
- **Разрешить пользователям авторизовываться через LDAP-сервер** – укажите имя сервера, через который будет проводиться авторизация. При необходимости можно перейти к созданию сервера сразу с этого  шага по ссылке **Создать**.
- **Оповестить пользователя, если был указан e-mail** – оповещать пользователей о регистрации на сайте с помощью выбранного шаблона, если в CSV-файле был указан e-mail.
- **Игнорировать пользователей, логин которых уже существует в системе** – укажите эту опцию, чтобы при импорте не добавлялись пользователи с логинами, которые уже существуют в системе.

Нажмите кнопку **Далее**. На следующем шаге выполняется автоматический импорт пользователей. После завершения импорта будет выведено сообщение о числе добавленных пользователей.

### Просмотр импортированных данных

Для просмотра импортированных данных в административном разделе перейдите на страницу **Список пользователей** (Настройки &gt; Пользователи &gt; Список пользователей). Откроется таблица со всеми пользователями системы.

Если импорт прошел неправильно, то необходимо удалить все записи, исправить CSV-файл и повторить описанные действия заново.
