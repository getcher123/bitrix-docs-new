# Автоматизация исполнения проекта

**Навигация**
- [← Оглавление курса](index.md)
- [← Предыдущий: 5857 — Сценарий автоматизации контроля оказания услуг](lesson_5857.md)
- [Следующий: 5515 — Сценарий для работы службы техподдержки →](lesson_5515.md)

Официальная страница урока: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=48&LESSON_ID=5823

### Описание




Рассмотрим возможный сценарий использования вашего *Bitrix Framework* для работы над проектом после закрытия [сделки](/learning/course/index.php?COURSE_ID=48&CHAPTER_ID=05026).




В нашем случае работа начинается после оплаты и закрытия сделки. После того, как менеджер перевел сделку в стадию **Сделка заключена**, на руководителя департамента и аналитика ставятся соответствующие их должностям типовые задачи с установленными сроками выполнения, в которые должна быть перенесена первичная информация из сделки. Менеджер должен проследить за корректным выполнением этих задач.




Для реализации такого сценария мы будем использовать [бизнес-процесс](/learning/course/index.php?COURSE_ID=48&LESSON_ID=3765) на изменение сделки. Чтобы исключить случаи постановки задач при изменении каких-либо других данных сделки со статусом **Сделка заключена**, нами будет создано пользовательское поле, в которое записывается факт перевода сделки в конечную стадию.





### Пользовательское поле




Создадим пользовательское поле для сделок:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/change_stage.png)




Значение поля по умолчанию - **0**. При переводе сделки в нужную нам стадию и постановки задач нужно будет менять его на **1**. Значение **1** и будет означать факт заключения сделки.





### Бизнес-процесс




На странице CRM &gt; Настройки &gt; Бизнес-процессы добавьте [шаблон](/learning/course/index.php?COURSE_ID=57&CHAPTER_ID=05042) на изменение для сделок. Откроется форма настройки параметров шаблона:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/crate_pattern_deal.png)




Создадим следующую схему шаблона бизнес-процесса:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/bp_deal_stage.png)




Разберем основные моменты его структуры. Сначала проверяется стадия сделки. Если она равна **Сделка заключена**, то осуществляется переход к проверке значения пользовательского поля **Изменялась стадия сделки**:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/variable_0.png)




В случае, когда значение данного поля **0**, переходим к постановке задач:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/task_descr.png)




Постановщиком выбран ответственный за сделку менеджер, что позволит ему быть в курсе работы над проектом.




В качестве крайнего срока указано выражение `=Dateadd({=System:Date}, "2 days")`, которое выставляет дату крайнего срока равной **текущая дата + 2 дня**.




В **Описание задачи** копируются поля сделки, такие как **Сумма в указанной валюте**, **Комментарий**, **Контакт**, **Компания**. Это позволит ответственному за задачу руководителю департамента сразу быть в курсе дел по данной задаче:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/view_task.png)




Далее выставлены другие параметры задачи, в том числе привязка к текущей сущности CRM, то есть сделке, что может пригодиться для контроля ведущейся с ней работы.




Аналогично ставится задача аналитику, затем в действии **Изменение пользовательского поля** выполняется смена значения пользовательского поля **Изменялась стадия сделки** на **1**.




Такое же действие, только с присваиванием значения **0**, применено в случае, если проверка стадии сделки выявила, что стадия не является **Сделка заключена**. Это сделано для случая, когда сделку переводят из конечного статуса в предварительный, а затем опять в **Сделка заключена**. Если бы такого действия не было, то в этом случае постановка задач снова не совершилась бы, поскольку значение поля оставалось бы **1**.
