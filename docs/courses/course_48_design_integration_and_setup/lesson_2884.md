# BI-коннектор

**Навигация**
- [← Оглавление курса](index.md)
- [← Предыдущий: 4755 — Экстранет](lesson_4755.md)
- [Следующий: 4743 — CRM →](lesson_4743.md)

Официальная страница урока: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=48&LESSON_ID=2884

Модуль предназначен для подключения к внешним

			BI-системам

                    Business Intelligence (BI) — это набор инструментов и технологий для сбора, анализа и обработки данных.

		 для обработки статистических данных, собираемых при работе портала.




### Настройка и работа с модулем




Настройка модуля осуществляется на странице *Настройки &gt; Настройки продукта &gt; Настройки модулей &gt; BI-коннектор*. Фактически на этой странице необходимо только задать права доступа для групп. *Идентификатор развертывания коннектора Google Datastudio* создаётся автоматически. Для подключения других систем идентификатор не требуется.




Работа с модулем включает:


- подключение BI-систем,
- управление ключами,
- управление отчётами.


Подробнее в статье [Битрикс24 BI-Аналитика.](https://helpdesk.bitrix24.ru/open/14888370/)





### Установка модуля




Если у вас не установлены последние обновления системы и версия модуля ниже 24.900.100, то по умолчанию модуль не установлен. Установка выполняется на странице *Настройки &gt; Настройки продукта &gt; Модули*.




Выберите необходимые опции:




- Скопировать публичные файлы и шаблон для сайта — опция обязательная. Флажок следует снимать, если заранее проведена кастомизация вывода информации.
- Переписывать существующие файлы — если обнаружатся файлы более ранних установок модуля, они будут перезаписаны.





### Установка дополнительного подключения




При установке будет использовано подключение к БД по умолчанию. Этот способ гарантирует работу, но для большей эффективности рекомендуется отредактировать

			файл настроек

                    Bitrix Framework имеет ряд специфичных настроек ядра, которые не имеют визуального интерфейса редактирования.

[Подробнее ...](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=02795)

		 ядра D7 `bitrix/.settings.php`:




- Из ключа `connections` скопируйте ключ `'default'` в ключ с новым именем, например, `biconnector`.
- В значении ключа `className` замените `Main` на `BIConnector`.
- При необходимости добавьте подключение файла для донастройки подключения `'include_after_connected'`.




Результат может выглядеть так:




```
'connections' => array (
	'value' => array (
		'default' => array (
			'className' => '\Bitrix\Main\DB\MysqliConnection',
			'host' => 'localhost',
			'database' => 'sitemanager',
			'login' => 'user',
			'password' => 'password',
			'options' => 2,
			'include_after_connected' => $_SERVER['DOCUMENT_ROOT'] . '/bitrix/' . 'php_interface/after_connect.php',
		),
		'biconnector' => array (
			'className' => '\Bitrix\BIConnector\DB\MysqliConnection',
			'host' => 'localhost',
			'database' => 'sitemanager',
			'login' => 'user',
			'password' => 'password',
			'options' => 2,
			'include_after_connected' => $_SERVER['DOCUMENT_ROOT'] . '/bitrix/' . 'php_interface/after_connect_bi.php',
		 ),
	),
	'readonly' => true,
),
```




Примерное содержимое файла `after_connect_bi.php`:




```
<?php
$this->queryExecute("SET NAMES 'utf-8'");
$this->queryExecute("SET sql_mode=''");
```




**Внимание:**

- Указание кодировки в файле `after_connect_bi.php` должно обязательно соответствовать кодировке сайта.
- Для донастройки подключения используется `$this`.
- Неверная правка может привести к полной неработоспособности проекта. Желательно выполнять правки или через SSH консоль или используя SFTP.
- Если подключение модуля BIConnector в `settings.php` добавляют уже после создания ключа, то ключ в публичной части надо пересохранить.





### Удаление модуля




Перейдите на страницу административного раздела со списком модулей. Найдите в таблице строку модуля BI-коннектор (biconnector) и нажмите кнопку Удалить. Появится запрос подтверждения на удаление с настройками процесса удаления. Снимите галочку у опции *Сохранить таблицы* если не хотите сохранять имеющиеся в системе данные.



Для удаления модуля нажмите кнопку Удалить модуль.




Если удаление прошло успешно, то на появившейся странице вы будете оповещены об этом соответствующим сообщением.




Нажмите кнопку Вернуться в список, чтобы перейти на страницу административного раздела со списком модулей.
