# Реализация сценария использования абонементов на посещения

**Навигация**
- [← Оглавление курса](index.md)
- [← Предыдущий: 3561 — Запретить показ пункта меню](lesson_3561.md)
- [Следующий: 5857 — Сценарий автоматизации контроля оказания услуг →](lesson_5857.md)

Официальная страница урока: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=48&LESSON_ID=6306

Рассмотрим реализацию продажи абонементов на посещения с помощью инструментов *Битрикс24*.



<!-- &lt;ul&gt;
  &lt;li&gt;&lt;a href="#task" &gt;Постановка задачи&lt;/a&gt;&lt;/li&gt;

  &lt;li&gt;&lt;a href="#deal" &gt;Создание сделки&lt;/a&gt;&lt;/li&gt;

  &lt;li&gt;&lt;a href="#bp" &gt;Бизнес-процесс&lt;/a&gt;&lt;/li&gt;

  &lt;li&gt;&lt;a href="#manager_task" &gt;Оповещение клиента&lt;/a&gt;&lt;/li&gt;

  &lt;li&gt;&lt;a href="#report" &gt;Подготовка отчета&lt;/a&gt;&lt;/li&gt;
 &lt;/ul&gt; -->



### Постановка задачи





В рассматриваемом сценарии необходимо реализовать продажу двух видов абонементов, различающихся по стоимости - на месяц и на две недели. При этом нужно вести учет посещений и отправлять ответственному менеджеру напоминания о заканчивающемся абонементе какого-либо клиента.




В данном примере, средствами *Битрикс24*, это сделано следующим образом. Для каждого клиента в CRM создается контакт, а под каждый абонемент - товар в каталоге CRM. При продаже абонемента контакту - создается сделка. После создания сделки запускается бизнес-процесс, который отчитывает время до окончания срока действия абонемента, и за несколько дней до его наступления ставит задачу ответственному за данную продажу менеджеру.





### Создание сделки





Рассмотрим поэтапно процедуру реализации данной схемы.




В разделе [товары](https://helpdesk.bitrix24.ru/open/5493761/) создается абонемент:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/abonement_tovar.png)




Аналогично создается товар **Двухнедельный абонемент**.




Для клиента, при покупке абонемента, создается сделка:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/gennady_add_tovar.png)




## Заполненная форма создания сделки

![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/deal_abonement.png)




Заполните необходимые поля в форме [создания сделки](https://helpdesk.bitrix24.ru/open/5315959/):




- указывается название и обязательно заполняетcя поле **Сумма**.
- При необходимости выбирается другой ответственный.
- Привязка с контакту будет установлена автоматически.
- Выбирается товар сделки.





### Бизнес-процесс





Затем запускается заранее созданный [бизнес-процесс](https://helpdesk.bitrix24.ru/open/5432347/) с автоматическим запуском при добавлении сделки:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/bp_scheme_abonement.png)




При создании любой сделки проверяется [условие](https://helpdesk.bitrix24.ru/open/7453445/) выполнения бизнес-процесса (**Покупка абонемента**), в котором сверяется значение поля **Сумма**. Рассмотрим пример ветки для месячного абонемента (для двухнедельного абонемента все сделано аналогично):




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/if_5800.png)




Бизнес-процесс будет выполняться дальше по данной ветке только в случае, если в поле **Сумма** созданной сделки прописано значение **5800**. Соответственно, для двухнедельного абонемента это значение меньше.




Затем ставится [пауза в выполнении](https://helpdesk.bitrix24.ru/open/7557393/) на 27 дней:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/27_days.png)




Для двухнедельного абонемента пауза равна 12 дням.




По прошествии 27 дней, менеджеру, заключившему данную сделку (предполагается, что он - ответственный) ставится задача об уведомлении клиента о скором истечении срока действия его абонемента:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/task_abonement.png)




- В крайнем сроке указано [выражение](https://helpdesk.bitrix24.ru/open/5428897/)
  ```
  =Dateadd({=System:Date}, "1 d")
  ```
     Оно устанавливает в качестве крайнего срока один день от текущей системной даты.
- В качестве постановщика выбирается начальник отдела.
- В описании задачи будет выведен идентификатор контакта, привязанного к сделке:
  ```
  {=Document:CONTACT_ID}
  ```
- Вы можете прикрепить задачу к сделке, установив значение **Да** в поле **Привязать к текущей сущности CRM**.





### Оповещение клиента





После окончания заданного в бизнес-процессе периода, ответственному за сделку менеджеру придет уведомление о том, что на него поставлена задача:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/uved_abonement.png)




Найдя по ID в [списке контактов](https://helpdesk.bitrix24.ru/open/5491741/) нужного клиента, менеджер уведомляет его об истечении срока действия абонемента и предлагает продление.






### Подготовка отчета







Учет посещений можно вести, [создав отчет](https://helpdesk.bitrix24.ru/open/1272889/) по делам:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/report_abonement.png)




В данном отчете будет учитываться любое дело (кроме события), в названии которого есть **посещение**. То есть, к каждому клиенту, при его визите, ответственному за него менеджеру следует добавлять дело, в названии которого будет слово **посещение**. В результате можно будет вести учет общего числа визитов по абонементам:




![](../../../images/courses/48/dev.1c-bitrix.ru/images/curs_b24/example/show_report_abonement.png)
