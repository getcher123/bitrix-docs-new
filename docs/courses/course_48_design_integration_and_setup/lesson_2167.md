# Если пропадает авторизация пользователя

**Навигация**
- [← Оглавление курса](index.md)
- [← Предыдущий: 23420 — Аутентификация по QR-коду](lesson_23420.md)
- [Следующий: 7169 — Постановка задачи →](lesson_7169.md)

Официальная страница урока: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=48&LESSON_ID=2167

|  | ### Если пропадает авторизация пользователя |
| --- | --- |

Возможные причины проблемы:

1. ## Лишние переносы строк (или иные символы) в скриптах конфигурации.
  Необходимо убедиться, что в коде файлов **dbconn.php**, **init.php** и **after_connect.php**, расположенных в папке `bitrix/php_interface`, не содержится переносов строк перед "&lt;?" и после "?&gt;".
2. ## Файлы с сессиями продукта создаются, но PHP не хватает прав, чтобы к ним обратиться.
  Попробуйте в файле `/bitrix/php_interface/dbconn.php` закомментировать строку:
  ```
  //@umask(~BX_DIR_PERMISSIONS);
  ```
3. ## Установлен лимит времени на бездействие пользователя, при превышении которого сессия удаляется.
  Вам необходимо в настройках группы пользователя на вкладке **Безопасность** увеличить значение **Время жизни сессии (минут)**.
  Значение по умолчанию можно изменить в файле **php.ini** (`Bitrix Environment\Apache2\zendserver\etc`): параметр `session.gc_maxlifetime`.
4. ## Значение параметра Маска сети для привязки сессии в настройках безопасности группы пользователей.
  Если оно равно, например, 255.255.255.255, то это означает, что при изменении IP пользователя авторизация будет сброшена.
5. ## Значение параметра session.cookie_domain в файле php.ini на сервере.
  Если оно задано - убедитесь, что оно соответствует URL вашего сайта. Если значение параметра `session.cookie_domain` равно www.site.ru, а Вы обращаетесь к системе по URL site.ru, то в этом случае сессия не будет сохранена, и, соответственно, авторизация не сохранится.
  Для решения проблемы необходимо установить в настройках PHP корректное значение параметра **session.cookie_domain**.
6. ## Неверно прописан домен в настройках главного модуля и для сайта отдельно.
  Проверьте значение поля **URL сайта** на странице административного режима Настройки &gt; Настройки продукта &gt; Настройки модулей &gt; Главный модуль.
  Проверить значение поля **URL сервера** можно, открыв настройки нужного сайта на странице административного раздела Настройки &gt; Настройки продукта &gt; Сайты &gt; Список сайтов.
  **Примечание**: также одной из причин может быть некорректное значение в параметрах сайта поля **Путь к корневой папке веб-сервера для этого сайта**, либо **Доменное имя**. Доменное имя можно сменить или удалить путем внесения изменений в файл **/hosts**.
7. ## При переносе сайта не скопировался файл /.access.php.
  В данном файле хранятся права групп пользователей к сайту, и если данного файла нет, то для всех пользователей право доступа устанавливается как **Запрещен**.
  Проблема решается одним из способов:
  - вам надо на странице административного раздела Контент &gt; Структура сайта &gt; Файлы и папки в меню действий корневой папки сайта выбрать пункт **Свойства папки** и на вкладке **Доступ** установить для группы **Все пользователи (в том числе неавторизованные)** право **Чтение**;
  - в корневую папку сайта загрузить файл **.access.php** со следующим содержанием:
    ```
    <? $PERM["/"]["*"]="R"; ?>
    ```
8. ## При многосайтовости вас выкидывает на форму авторизации при переходе по публичным страницам сайта.
  Проверьте содержимое файла **.access.php** на идентичность следующему коду:
  ```
  <?
  $PERM["/"]["*"]="R";
  ?>
  ```
9. ## Авторизация не учитывается на вашем домене.
  На закладке **Авторизация** страницы настроек главного модуля (Настройки &gt; Настройки продукта &gt; Настройки модулей &gt; Главный модуль) поставьте галочку в поле **Распространять авторизацию на все домены**.
10. ## Проблема в работе сервера (нужна поддержка сессий в php, должна быть указана папка сохранения сессий и права на запись в эту папку).
  Проверьте исправность работы сервера с сессиями с помощью [данного скрипта](https://dev.1c-bitrix.ru/download/scripts/bitrix_server_test.php) и в случае наличия неполадок обратитесь к администратору сервера.
11. ## Проблемы авторизации при поддоменности на разных установках
  При наличии сайтов вида site.ru и crm.site.ru (т.е. на **поддомене**), которые выполнены на
  			разных установках
                      Например первая установка - продукт *1С-Битрикс: Управление сайтом*, а вторая - *1С-Битрикс24: CRM*.
  		, могут возникнуть проблемы с авторизацией. Вызвано это дублированием переменной **PHPSESSID** в cookie.
  Дальнейшие действия зависят от конфигурации этих сайтов. Подробнее описано в уроке [Авторизация при поддоменности на разных установках](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=103&LESSON_ID=20670&LESSON_PATH=8799.3987.20670) в курсе Многосайтовость.

**Примечание**: если работа в административном режиме прерывается появляющейся формой авторизации, то чтобы дать себе возможность что-то поправить в настройках сайта, после авторизации не совершайте никаких действий порядка 10-30 секунд, и, возможно, форма авторизации не появится.
